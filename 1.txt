commit cae9912403c5b7434ca4413558e69e81f3852086
Author: Quarx2k <agent00791@gmail.com>
Date:   Sun Oct 18 00:03:19 2015 +0600

    Add binder symbol for our libril

diff --git a/device_w7.mk b/device_w7.mk
index 649f90b..733ca7c 100644
--- a/device_w7.mk
+++ b/device_w7.mk
@@ -140,7 +140,8 @@ PRODUCT_PACKAGES += \
     libcurl \
     tcpdump \
     Torch \
-    libxml2
+    libxml2 \
+    libsymbols-compat
 
 # Misc
 PRODUCT_PACKAGES += \
diff --git a/libsymbols-compat/Android.mk b/libsymbols-compat/Android.mk
new file mode 100644
index 0000000..fafb965
--- /dev/null
+++ b/libsymbols-compat/Android.mk
@@ -0,0 +1,23 @@
+# Copyright (C) 2008 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+LOCAL_PATH:= $(call my-dir)
+
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES := libsymbols-compat.cpp
+LOCAL_SHARED_LIBRARIES := liblog libbinder
+LOCAL_MODULE := libsymbols-compat
+LOCAL_MODULE_TAGS := optional
+include $(BUILD_SHARED_LIBRARY)
+
diff --git a/libsymbols-compat/libsymbols-compat.cpp b/libsymbols-compat/libsymbols-compat.cpp
new file mode 100644
index 0000000..127cdab
--- /dev/null
+++ b/libsymbols-compat/libsymbols-compat.cpp
@@ -0,0 +1,28 @@
+/*
+ * Copyright (C) 2015 The Android Open Source Project, Quarx2k(https://github.com/Quarx2k)
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <binder/Parcel.h>
+
+//libril.so need this symbol
+namespace android {
+
+extern "C" status_t _ZN7android6Parcel13writeString16EPKtj(const String16& str)
+{
+    Parcel data;
+    return data.writeString16(str.string(), str.size());
+}
+
+};
diff --git a/rootdir/init.w7.rc b/rootdir/init.w7.rc
index 2c2b9d0..e740fe3 100755
--- a/rootdir/init.w7.rc
+++ b/rootdir/init.w7.rc
@@ -27,6 +27,9 @@
  
 import init.w7.usb.rc
 
+on early-init
+    export LD_PRELOAD "/system/lib/libsymbols-compat.so"
+
 on init
 
     # Support legacy paths
